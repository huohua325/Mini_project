# Shapeville Game 模块开发指南

## 概述

Game 模块是 Shapeville 几何学习乐园的核心业务逻辑层，负责处理各种几何任务的计算、验证和评分功能。该模块与 GUI 层分离，专注于数据处理和计算逻辑，可独立测试和运行。

## 模块结构

```
game/
├── AngleCalculation.java           # 角度计算与识别逻辑
├── AreaCalculation.java            # 各种基本形状面积计算
├── CircleCalculation.java          # 圆的周长、面积计算
├── CompoundShapeCalculation.java   # 复合形状面积计算
├── SectorCalculation.java          # 扇形面积和弧长计算
└── ShapeRecognition.java           # 2D和3D形状识别
```

## 各类详细说明

### 1. AngleCalculation.java

角度识别与计算的核心业务逻辑。

#### 主要功能
- 生成随机角度并判定类型（锐角、直角、钝角、平角、优角）
- 验证用户答案
- 记录已识别的角度类型
- 计算任务完成进度和得分

#### 核心方法
- `getAngleType(int angle)`: 根据角度值返回角度类型
- `checkAnswer(int angle, String answer)`: 检查用户回答是否正确
- `isTaskComplete()`: 判断任务是否完成（识别了足够多的角度类型）
- `calculateScore(List<Integer> attempts)`: 根据尝试次数计算得分

#### 扩展建议
- 添加更复杂的角度判定，如补角、余角关系
- 增加角度类型的中文描述
- 添加角度计算功能（如：已知两条线段的角度，计算夹角）

### 2. AreaCalculation.java

基本几何形状面积计算的核心业务逻辑。

#### 主要功能
- 生成随机的几何形状及其参数
- 计算形状面积
- 验证用户计算结果
- 提供形状的面积公式和步骤

#### 核心方法
- `generateParams(ShapeType shape)`: 生成指定形状的随机参数
- `getFormula(ShapeType shape)`: 获取形状的面积计算公式
- `checkAnswer(double answer)`: 验证用户答案
- `getSubstitutionString(ShapeType shape)`: 获取代入数值的计算过程

#### 可用形状
- 矩形 (Rectangle)
- 平行四边形 (Parallelogram)
- 三角形 (Triangle)
- 梯形 (Trapezium)

#### 扩展建议
- 添加更多形状类型，如菱形、正多边形
- 增加不同的计算方法（如三角形的海伦公式）
- 添加难度分级功能

### 3. CircleCalculation.java

圆形相关计算的核心业务逻辑。

#### 主要功能
- 生成随机半径/直径值
- 计算圆的周长和面积
- 验证用户计算结果
- 提供计算公式和步骤

#### 练习类型
- 已知半径求面积
- 已知半径求周长
- 已知直径求面积
- 已知直径求周长

#### 扩展建议
- 添加弧长计算功能
- 添加圆环面积计算
- 扩展为圆相关的更复杂问题（如切线、弦长计算）

### 4. CompoundShapeCalculation.java

复合形状面积计算的核心业务逻辑。

#### 主要功能
- 管理预定义的复合形状集合
- 提供复合形状的描述和计算步骤
- 验证用户计算结果
- 跟踪已完成的形状

#### 复合形状类型
目前包含9种复合形状：
- 箭头形状
- T形状
- 梯形
- 阶梯形状
- 阶梯状矩形
- 双阶梯形状
- 房屋形状
- 复杂阶梯
- 不规则四边形

#### 关键结构
- `CompoundShape` 内部类：封装复合形状的属性和方法
- 每个形状都有对应的 renderer 用于图形显示

#### 扩展建议
- 添加更多复杂的复合形状
- 实现动态生成复合形状的功能
- 添加分解计算步骤的详细指导

### 5. SectorCalculation.java

扇形计算的核心业务逻辑。

#### 主要功能
- 管理预定义的扇形集合
- 计算扇形面积
- 验证用户计算结果
- 提供计算公式和步骤
- 渲染扇形图形

#### 关键结构
- `Sector` 内部类：封装扇形的属性和方法，包括绘制功能

#### 当前定义的扇形
共8个预定义扇形，具有不同的半径、角度和单位

#### 扩展建议
- 添加扇形弧长计算
- 添加随机生成扇形的功能
- 实现扇形组合计算
- 扩展为圆相关的其他几何问题

### 6. ShapeRecognition.java

形状识别的核心业务逻辑。

#### 主要功能
- 管理2D和3D形状集合
- 随机选择形状进行识别测试
- 验证用户识别结果
- 跟踪已识别的形状类型

#### 核心方法
- `check2DAnswer(Shape2D shape, String answer)`：验证2D形状识别结果
- `check3DAnswer(Shape3D shape, String answer)`：验证3D形状识别结果
- `is2DComplete()`/`is3DComplete()`：判断任务是否完成
- `reset()`：重置识别状态

#### 扩展建议
- 添加更多形状类型
- 增加形状的属性和特征描述
- 实现形状比较和分类功能
- 添加形状间的关系识别（如：哪些形状是四边形）

## 通用设计模式

1. **任务进度跟踪**：各模块都实现了跟踪用户进度的机制
2. **尝试次数管理**：限制用户尝试次数（通常为3次）
3. **评分系统**：根据尝试次数计算得分
4. **命令行交互**：提供独立的命令行交互模式（便于测试）
5. **参数随机生成**：动态生成任务参数，确保每次体验不同

## 开发指南

### 添加新的形状

1. 如需添加新的基本形状：
   - 在 `AreaCalculation.ShapeType` 中添加新的形状类型
   - 在 `generateParams()` 方法中添加新类型的参数生成逻辑
   - 在 `getFormula()` 和 `getSubstitutionString()` 中添加对应的公式和计算过程

2. 如需添加新的复合形状：
   - 在 `gui.shapes.compound` 包中创建新的形状类（实现 `ShapeRenderer` 接口）
   - 在 `CompoundShapeCalculation.initializeShapes()` 方法中添加新的形状实例

### 扩展计算功能

1. 向现有类添加新的计算方法：
   - 在对应的类中定义新的方法
   - 确保提供正确的公式和计算逻辑
   - 添加适当的验证和反馈机制

2. 创建全新的计算任务类：
   - 创建新的Java类（命名格式：`[计算类型]Calculation.java`）
   - 参考现有类实现类似的功能结构
   - 在GUI层添加对应的面板类

### 改进评分系统

当前评分系统基于尝试次数计算得分，可以考虑以下改进：

1. 添加时间因素：根据完成任务的时间调整得分
2. 实现难度系数：根据任务难度调整分值
3. 连续答对奖励：连续答对增加额外分数

## 与GUI层集成

Game模块设计为与GUI层松耦合，主要通过以下方式集成：

1. **数据传递**：GUI层调用Game层方法获取数据和验证结果
2. **状态管理**：GUI层负责显示，Game层管理业务状态
3. **事件处理**：GUI层捕获用户输入，传递给Game层处理

## 注意事项

1. 保持Game模块的独立性，避免引入UI相关代码
2. 确保数值计算的精度和边界处理
3. 添加适当的异常处理和输入验证
4. 保持命令行模式功能可用，便于单元测试
5. 维护良好的注释和文档

## 单元测试建议

为以下关键功能编写单元测试：

1. 各类形状的面积计算公式
2. 角度类型判定逻辑
3. 答案验证和评分机制
4. 随机参数生成的范围和分布

## 未来发展方向

1. 增加3D形状的体积和表面积计算
2. 添加坐标几何相关计算
3. 实现动态难度调整
4. 添加更多可视化和交互功能
5. 实现实时协作学习模式 